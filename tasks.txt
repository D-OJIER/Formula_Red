<<<<<<< HEAD
FORMULA RED – CURSOR AI TASK PROMPTS (Use this file as sequential tasks
inside Cursor AI)

  --------------------------------------------------
  GLOBAL CONTEXT FOR CURSOR
  --------------------------------------------------
  TASK 1 – Project bootstrap

  Create a new Devvit project named formula-red.

  Include: - main entry file - Devvit UI rendering
  setup - KV storage usage - basic logging helpers
  --------------------------------------------------

TASK 2 – Core domain models

Create TypeScript interfaces for:

RaceDay TrackConfig PracticeSession RaceResult DriverSubmission
SeasonStanding

All fields must match the Formula Red documentation.

  --------------------------------------------------
  TASK 3 – Track generator
  --------------------------------------------------
  TASK 4 – Daily modifier generator

  Implement:

  generateDailyModifier(trackSeed: string)

  Return exactly one modifier per day: - RAIN -
  DIRTY_AIR - HIGH_TYRE_WEAR - SAFETY_CAR - LOW_GRIP

  Must be deterministic.
  --------------------------------------------------

TASK 5 – Simulation engine

Implement:

simulateLap( track: TrackConfig, modifier, submission, userId,
seedSuffix )

Use the Formula Red lap time formula and deterministic RNG.

Support both: - practice runs (with telemetry noise) - race runs (clean
model)

  --------------------------------------------------
  TASK 6 – Practice session storage
  --------------------------------------------------
  TASK 7 – Race storage

  Implement KV helpers for:

  race:YYYYMMDD

  Fields: - trackSeed - trackConfig - modifier -
  results - frozen

  Enforce: - one official submission per user -
  cannot submit after frozen = true
  --------------------------------------------------

TASK 8 – Season storage

Implement:

season:current

Track: - standings per user - podium count per user - racesPlayed per
user

  --------------------------------------------------
  TASK 9 – Points system
  --------------------------------------------------
  TASK 10 – End of day finalization job

  Implement a job or scheduled handler that:

  - freezes the race - sorts results - selects
  podium (P1, P2, P3) - updates season standings
  --------------------------------------------------

TASK 11 – Session time controller

Implement helpers that determine the active session based on UTC time:

P1 00:00–04:00 P2 04:00–08:00 P3 08:00–12:00 P4 12:00–16:00 RACE
16:00–23:59

Return enum: P1 | P2 | P3 | P4 | RACE | CLOSED

  --------------------------------------------------
  TASK 12 – UI layout
  --------------------------------------------------
  TASK 13 – Submission handler

  Implement handler that:

  - validates active session - blocks duplicate
  submissions - runs simulation - stores result -
  refreshes leaderboard
  --------------------------------------------------

TASK 14 – Leaderboard sorting

Implement sorting utilities:

-   ascending lap time
-   stable ordering
-   tie-break using submission timestamp

  --------------------------------------------------
  TASK 15 – Podium announcement
  --------------------------------------------------
  TASK 16 – Admin tools

  Implement moderator-only actions:

  - force freeze race - recompute race results -
  reset practice sessions for a day
  --------------------------------------------------

TASK 17 – Anti-abuse

Add guards for:

-   multiple submissions
-   late submissions
-   corrupted data
-   invalid session access

  --------------------------------------------------
  TASK 18 – Deterministic RNG utility
  --------------------------------------------------
  TASK 19 – Telemetry noise (practice only)

  Inject a small bounded random offset ONLY in
  practice simulation.
  --------------------------------------------------

TASK 20 – Minimal tests

Create simple unit tests for:

-   track generator determinism
-   modifier generator determinism
-   simulation determinism
-   points calculation

------------------------------------------------------------------------

FINAL GOAL

The system must fully support:

-   four practice sessions per day
-   one official race per day
-   professional season leaderboard
-   deterministic and fair simulation

This project must exactly follow the Formula Red documentation.
=======
FORMULA RED – DRIVER EDITION (NO TIME WINDOWS) Cursor AI Task List –
Build Specification

GLOBAL CONTEXT

You are building Formula Red – Driver Edition. Players actually drive
the car in a web racing game. Devvit is used only as the league
controller and storage layer.

Rules: - One global track per day (trackId = YYYYMMDD) - Unlimited
practice runs (not stored in leaderboards) - Player may directly attempt
the official race - Exactly ONE official lap per user per day - Daily
leaderboard and season leaderboard are maintained - Track changes every
day automatically

All tasks below must be implemented in a Devvit TypeScript project and a
small web racing client.

  --------------------------------------------------
  TASK 1 – Devvit project bootstrap
  --------------------------------------------------
  TASK 2 – Core domain models

  Create TypeScript interfaces for:

  TrackConfig DailyRace OfficialRaceResult
  SeasonStanding CarConfig SubmissionPayload
  --------------------------------------------------

TASK 3 – Daily track generator

Implement:

generateDailyTrack(trackId: string): TrackConfig

trackId is YYYYMMDD. The generator must be deterministic.

Fields: - length - cornerDensity - straightRatio - width - surfaceGrip -
elevationProfile - weatherProbability

  --------------------------------------------------
  TASK 4 – Daily race store
  --------------------------------------------------
  TASK 5 – Season store

  Implement KV helpers for:

  season:current

  Track: - totalPoints per user - podiumCount per
  user - racesPlayed per user
  --------------------------------------------------

TASK 6 – Car configuration model

Implement car configuration schema:

-   downforce
-   gearBias
-   tyres
-   drivingStyle
-   tacticalAbility

  --------------------------------------------------
  TASK 7 – Web driving game scaffold
  --------------------------------------------------
  TASK 8 – Config driven handling

  Apply car configuration to handling:

  - downforce affects grip and cornering speed -
  gear bias affects acceleration curve and max
  speed - tyres affect grip and slide tolerance -
  driving style affects boost power and stability
  --------------------------------------------------

TASK 9 – Practice mode

Implement practice mode in the web game:

-   unlimited laps
-   lap times shown only locally
-   no server submission

  --------------------------------------------------
  TASK 10 – Official race mode
  --------------------------------------------------
  TASK 11 – Submission API contract

  Implement Devvit endpoint:

  POST /submit-official-run

  Payload: - userId - trackId - lapTime - config -
  checkpointTimes - replayHash
  --------------------------------------------------

TASK 12 – Submission validation

On backend:

-   verify trackId equals today
-   verify race not frozen
-   verify user has no existing official result
-   verify lap time bounds
-   verify checkpoints order

  --------------------------------------------------
  TASK 13 – Official result storage
  --------------------------------------------------
  TASK 14 – Leaderboard utilities

  Implement:

  getDailyLeaderboard(trackId)

  Sorted by: - lapTime ascending - timestamp
  tie-break
  --------------------------------------------------

TASK 15 – Player result view

After submission return:

-   player rank
-   player lap time
-   top leaderboard slice

  --------------------------------------------------
  TASK 16 – Devvit UI
  --------------------------------------------------
  TASK 17 – One submission enforcement

  Implement guard:

  - only one official run per user per trackId
  --------------------------------------------------

TASK 18 – End of day finalization

Implement daily job:

-   freeze race
-   compute final ranking
-   update season standings
-   compute podium

  --------------------------------------------------
  TASK 19 – Points system
  --------------------------------------------------
  TASK 20 – Season leaderboard API

  Implement:

  getSeasonLeaderboard()

  Sorted by totalPoints then podiumCount.
  --------------------------------------------------

TASK 21 – Anti-cheat baseline

Implement: - replay hash validation placeholder - suspicious lap time
flagging - duplicated checkpoint detection

  --------------------------------------------------
  TASK 22 – Track rotation
  --------------------------------------------------
  TASK 23 – Minimal tests

  Add unit tests for:

  - track generator determinism - one-submission
  rule - leaderboard sorting - points calculation
  --------------------------------------------------

FINAL GOAL

Players can: - configure their car - drive the track themselves -
practice freely - submit exactly one official lap per day - see live
daily leaderboard - compete across a full season
>>>>>>> 438b59959e5794ac3868ba08d6554530dbf2bb23
